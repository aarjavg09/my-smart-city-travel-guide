<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Smart City â€” Emergency Support & Helplines</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="" crossorigin="" />
  <style>
    :root{
      --accent:#0b74de; /* friendly blue */
      --danger:#e03131;
      --bg:#f6f9fc;
      --card:#ffffff;
      --muted:#6b7280;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:#0f172a}
    .app{max-width:1100px;margin:28px auto;padding:18px}
    header{display:flex;align-items:center;gap:16px}
    .brand{display:flex;flex-direction:column}
    h1{margin:0;font-size:20px}
    p.lead{margin:2px 0 0;color:var(--muted);font-size:13px}

    .layout{display:grid;grid-template-columns:420px 1fr;gap:16px;margin-top:14px}
    .panel{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 4px 18px rgba(10,15,30,0.06)}

    .search{display:flex;gap:8px;align-items:center}
    .search input{flex:1;padding:10px;border-radius:8px;border:1px solid #e6e9ef}
    .filter{display:flex;gap:8px;margin-top:10px}
    .chip{padding:8px 10px;border-radius:999px;border:1px solid #e6e9ef;font-size:13px;cursor:pointer}
    .chip.active{background:var(--accent);color:white;border-color:transparent}

    #map{height:560px;border-radius:12px;overflow:hidden}

    .list{margin-top:12px}
    .place{display:flex;gap:12px;padding:10px;border-radius:8px;border:1px solid #f0f2f5;margin-bottom:8px;align-items:center}
    .place .meta{flex:1}
    .place h3{margin:0;font-size:15px}
    .place p{margin:6px 0 0;color:var(--muted);font-size:13px}
    .actions{display:flex;gap:8px}
    .btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
    .btn.call{background:linear-gradient(90deg,#06b6d4,#0b74de);color:white}
    .btn.dir{background:#eef2ff;color:#3730a3}
    .btn.small{padding:6px 8px;font-size:13px}

    .emergency-row{display:flex;gap:10px;margin-top:12px}
    .panic{flex:1;background:var(--danger);color:white;padding:14px;border-radius:12px;font-weight:600;border:none;cursor:pointer}
    .assist{background:#0f172a;color:white;padding:14px;border-radius:12px;border:none;cursor:pointer}

    .badge{display:inline-flex;align-items:center;gap:8px;padding:6px 8px;border-radius:999px;background:#f1f5f9;font-size:13px}

    footer{margin-top:14px;color:var(--muted);font-size:13px}

    @media (max-width:920px){
      .layout{grid-template-columns:1fr;}
      #map{height:420px}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="24" height="24" rx="6" fill="#0b74de"/><path d="M7 13h10M7 9h10M7 17h6" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      </div>
      <div class="brand">
        <h1>Smart City â€” Emergency Support & Helplines</h1>
        <p class="lead">Nearby hospitals, police stations, ambulance contacts and oneâ€‘tap 24Ã—7 emergency actions.</p>
      </div>
      <div style="margin-left:auto" class="badge">24Ã—7 Emergency â€¢ Tap to call â€¢ Guides & routes</div>
    </header>

    <main class="layout">
      <aside class="panel">
        <div class="search">
          <input id="search" placeholder="Search city, area or place (e.g., Mumbai, Colaba)" />
          <button id="locateBtn" title="Use my location" class="chip">Use my location</button>
        </div>
        <div class="filter" role="tablist" aria-label="Filter by type">
          <div class="chip active" data-type="all">All</div>
          <div class="chip" data-type="hospital">Hospitals</div>
          <div class="chip" data-type="police">Police</div>
          <div class="chip" data-type="ambulance">Ambulance</div>
        </div>

        <div class="emergency-row">
          <button id="panicBtn" class="panic">ðŸ†˜ PANIC â€” Send Alert</button>
          <button id="helpCenterBtn" class="assist">ðŸ“ž Quick Call</button>
        </div>

        <div class="list" id="placesList" aria-live="polite">
          <!-- places generated by JS -->
        </div>

        <footer>
          Tip: tap <strong>Call</strong> to start a phone call, or <strong>Directions</strong> to open your maps app.
        </footer>
      </aside>

      <section class="panel">
        <div id="map"></div>
      </section>
    </main>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // --- Sample data: replace with API or backend in production ---
    const PLACES = [
      {id:1,type:'hospital',name:'City General Hospital',phone:'+911234567890',lat:19.075,lon:72.8777,address:'123 Main St, Central'},
      {id:2,type:'police',name:'Central Police Station',phone:'+911112223334',lat:19.076,lon:72.8785,address:'Police HQ, Central'},
      {id:3,type:'ambulance',name:'Rapid Ambulance Service',phone:'+919876543210',lat:19.074,lon:72.876,address:'Near Market'},
      {id:4,type:'hospital',name:'St Marys Clinic',phone:'+919998887776',lat:19.072,lon:72.880,address:'North Road'},
    ];

    // Initialize map
    const map = L.map('map', {zoomControl:true}).setView([19.075,72.8777], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom:19, attribution:'Â© OpenStreetMap contributors'}).addTo(map);

    // marker layer
    const markers = L.layerGroup().addTo(map);

    function iconFor(type){
      const colors = {hospital:'#e11d48',police:'#0b74de',ambulance:'#f97316'};
      const c = colors[type] || '#64748b';
      return L.divIcon({className:'custom-marker',html:`<div style="background:${c};width:14px;height:14px;border-radius:50%;box-shadow:0 0 0 6px rgba(0,0,0,0.05)"></div>`,iconSize:[20,20]});
    }

    function renderMarkers(list){
      markers.clearLayers();
      list.forEach(p=>{
        const m = L.marker([p.lat,p.lon],{icon:iconFor(p.type)}).addTo(markers);
        m.bindPopup(`<strong>${escapeHtml(p.name)}</strong><br>${escapeHtml(p.address || '')}<br><a href='tel:${p.phone}'>Call: ${p.phone}</a> | <a href='https://www.google.com/maps/dir/?api=1&destination=${p.lat},${p.lon}' target='_blank'>Directions</a>`);
      });
    }

    function escapeHtml(s){return String(s||'').replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c]));}

    // Render place list
    const listEl = document.getElementById('placesList');
    function renderList(list){
      listEl.innerHTML = '';
      list.forEach(p=>{
        const div = document.createElement('div'); div.className='place';
        div.innerHTML = `<div class="meta"><h3>${escapeHtml(p.name)} <span style="font-size:12px;color:var(--muted);margin-left:8px">${p.type.toUpperCase()}</span></h3><p>${escapeHtml(p.address)} â€¢ ${p.phone}</p></div>`;
        const actions = document.createElement('div'); actions.className='actions';
        const call = document.createElement('button'); call.className='btn call small'; call.innerText='Call'; call.onclick = ()=>window.location.href = `tel:${p.phone}`;
        const dir = document.createElement('button'); dir.className='btn dir small'; dir.innerText='Directions'; dir.onclick = ()=> window.open(`https://www.google.com/maps/dir/?api=1&destination=${p.lat},${p.lon}`,'_blank');
        actions.appendChild(call); actions.appendChild(dir);
        div.appendChild(actions);
        listEl.appendChild(div);
      });
    }

    // initial render
    renderMarkers(PLACES);
    renderList(PLACES);

    // Filter chips
    document.querySelectorAll('.chip').forEach(ch=>{
      ch.addEventListener('click',()=>{
        document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
        ch.classList.add('active');
        const t = ch.dataset.type;
        applyFilters();
      });
    });

    // Search input
    document.getElementById('search').addEventListener('input',applyFilters);

    function applyFilters(){
      const q = document.getElementById('search').value.trim().toLowerCase();
      const active = document.querySelector('.chip.active').dataset.type;
      let filtered = PLACES.filter(p=> (active==='all' || p.type===active) && (q==='' || (`${p.name} ${p.address}`).toLowerCase().includes(q)) );
      renderMarkers(filtered);
      renderList(filtered);
      if(filtered.length>0){
        const first = filtered[0]; map.setView([first.lat, first.lon], 14);
      }
    }

    // Locate user
    document.getElementById('locateBtn').addEventListener('click',()=>{
      if(!navigator.geolocation){alert('Geolocation not supported');return}
      navigator.geolocation.getCurrentPosition(pos=>{
        const {latitude:lat,longitude:lon} = pos.coords;
        map.setView([lat,lon],14);
        L.circle([lat,lon],{radius:80,fill:false,color:'#0b74de'}).addTo(markers);
        // Optionally: compute nearest places
        const distances = PLACES.map(p=>({p,dist:distance(lat,lon,p.lat,p.lon)})).sort((a,b)=>a.dist-b.dist);
        const nearest = distances.slice(0,3).map(d=>d.p);
        renderMarkers(nearest);
        renderList(nearest);
      },err=>{alert('Could not get location: '+err.message)})
    });

    function distance(lat1,lon1,lat2,lon2){ // rough km
      const R=6371; const dLat=(lat2-lat1)*Math.PI/180; const dLon=(lon2-lon1)*Math.PI/180; const a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)*Math.sin(dLon/2); const c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)); return R*c;
    }

    // Panic button: attempts to get geolocation and open a pre-filled mailto / simulate sending an alert
    document.getElementById('panicBtn').addEventListener('click',async ()=>{
      if(!navigator.geolocation){alert('Geolocation not supported');return}
      const btn = document.getElementById('panicBtn'); btn.disabled=true; btn.innerText='Sending alert...';
      navigator.geolocation.getCurrentPosition(pos=>{
        const {latitude:lat,longitude:lon} = pos.coords;
        // In production: POST to your emergency backend with user id, coordinates, timestamp
        // For demo we open an email with coordinates (user must have mail client set up)
        const subject = encodeURIComponent('EMERGENCY ALERT');
        const body = encodeURIComponent(`I need immediate help. My approximate location: https://www.google.com/maps/search/?api=1&query=${lat},${lon}`);
        window.location.href = `mailto:emergency@city.gov?subject=${subject}&body=${body}`;
        btn.disabled=false; btn.innerText='ðŸ†˜ PANIC â€” Send Alert';
      },err=>{alert('Could not get location: '+err.message); btn.disabled=false; btn.innerText='ðŸ†˜ PANIC â€” Send Alert';})
    });

    // Quick call helper: opens an action sheet (simple prompt for demo)
    document.getElementById('helpCenterBtn').addEventListener('click',()=>{
      const options = PLACES.map(p=>`${p.name} (${p.type}) - ${p.phone}`).join('\n');
      const pick = prompt('Quick Call â€” pick number:\n'+options+'\n\nType the exact phone number to call:');
      if(pick) window.location.href = `tel:${pick.replace(/[^+0-9]/g,'')}`;
    });

    // Accessibility: keyboard quick keys
    document.addEventListener('keydown',(e)=>{
      if(e.key==='e') document.getElementById('panicBtn').focus();
      if(e.key==='l') document.getElementById('locateBtn').focus();
    });

    // Replace PLACES with real API: function to load from server (example)
    async function loadFromApi(city){
      // Example:
      // const res = await fetch(`/api/places?city=${encodeURIComponent(city)}`);
      // const data = await res.json();
      // PLACES = data;
      // renderMarkers(PLACES); renderList(PLACES);
    }

  </script>
</body>
</html>
